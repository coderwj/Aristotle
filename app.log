

var config = require('./config');

var path = require('path');
var express = require('express');
require('./middlewares/mongoose_log'); // 打印 mongodb 查询日志
require('./models');
var webRouter = require('./web_router');
var errorPageMiddleware = require('./middlewares/error_page');

var errorhandler = require('errorhandler');
var requestLog = require('./middlewares/request_log');
var logger = require('./common/logger');

var urlinfo = require('url').parse(config.host);
config.hostname = urlinfo.hostname || config.host;

// 静态文件目录
var staticDir = path.join(__dirname, 'public');

var app = express();


// Request logger。请求时间
app.use(requestLog);


// 静态资源
app.use('/public', express.static(staticDir));

app.use(errorPageMiddleware.errorPage);

app.use('/', webRouter);

// error handler
if (config.debug) {
  app.use(errorhandler());
} else {
  app.use(function (err, req, res, next) {
    logger.error(err);
    return res.status(500).send('500 status');
  });
}

if (!module.parent) {
  app.listen(config.port, function () {
    logger.info('Aristotle listening on port', config.port);
    logger.info('You can debug your app with http://' + config.hostname + ':' + config.port);
  });
}

module.exports = app;
[2016-10-30 13:25:45.316] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 13:25:45.319] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 13:26:23.240] [INFO] cheese - 

Started 2016-10-30T05:26:23.239Z GET / ::1
[2016-10-30 13:26:23.249] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:26:23.381] [INFO] cheese - 

Started 2016-10-30T05:26:23.381Z GET /favicon.ico ::1
[2016-10-30 13:26:23.385] [INFO] cheese - Completed 404 undefined
[2016-10-30 13:27:14.260] [INFO] cheese - 

Started 2016-10-30T05:27:14.260Z GET / ::1
[2016-10-30 13:27:14.262] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:28:14.167] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 13:28:14.170] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 13:28:19.328] [INFO] cheese - 

Started 2016-10-30T05:28:19.328Z GET / ::1
[2016-10-30 13:28:19.340] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:29:28.905] [INFO] cheese - 

Started 2016-10-30T05:29:28.905Z GET / ::1
[2016-10-30 13:29:28.908] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:29:29.792] [INFO] cheese - 

Started 2016-10-30T05:29:29.792Z GET / ::1
[2016-10-30 13:29:29.794] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:29:30.142] [INFO] cheese - 

Started 2016-10-30T05:29:30.142Z GET / ::1
[2016-10-30 13:29:30.144] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:29:30.434] [INFO] cheese - 

Started 2016-10-30T05:29:30.434Z GET / ::1
[2016-10-30 13:29:30.437] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:30:22.848] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 13:30:22.850] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 13:30:25.804] [INFO] cheese - 

Started 2016-10-30T05:30:25.804Z GET / ::1
[2016-10-30 13:31:18.613] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 13:31:18.615] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 13:31:20.858] [INFO] cheese - 

Started 2016-10-30T05:31:20.856Z GET / ::1
[2016-10-30 13:31:20.867] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:31:54.596] [INFO] cheese - 

Started 2016-10-30T05:31:54.596Z GET / ::1
[2016-10-30 13:31:54.599] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:31:57.321] [INFO] cheese - 

Started 2016-10-30T05:31:57.321Z GET / ::1
[2016-10-30 13:31:57.323] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:32:07.638] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 13:32:07.641] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 13:32:09.754] [INFO] cheese - 

Started 2016-10-30T05:32:09.754Z GET / ::1
[2016-10-30 13:32:09.764] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:35:39.073] [INFO] cheese - 

Started 2016-10-30T05:35:39.073Z GET / ::1
[2016-10-30 13:35:39.076] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:35:40.229] [INFO] cheese - 

Started 2016-10-30T05:35:40.229Z GET / ::1
[2016-10-30 13:35:40.231] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:35:40.554] [INFO] cheese - 

Started 2016-10-30T05:35:40.554Z GET / ::1
[2016-10-30 13:35:40.556] [INFO] cheese - Completed 500 undefined
[2016-10-30 13:35:40.868] [INFO] cheese - 

Started 2016-10-30T05:35:40.868Z GET / ::1
[2016-10-30 13:35:40.871] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:00:11.231] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:00:11.234] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:00:40.739] [INFO] cheese - 

Started 2016-10-30T06:00:40.738Z GET /signin ::1
[2016-10-30 14:00:40.748] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:02:43.982] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:02:43.985] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:02:48.322] [INFO] cheese - 

Started 2016-10-30T06:02:48.321Z GET /signin ::1
[2016-10-30 14:02:48.335] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:17:15.000] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:17:15.003] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:17:19.691] [INFO] cheese - 

Started 2016-10-30T06:17:19.691Z GET /signin ::1
[2016-10-30 14:17:19.706] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:17:52.837] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:17:52.840] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:17:55.703] [INFO] cheese - 

Started 2016-10-30T06:17:55.703Z GET /signin ::1
[2016-10-30 14:17:55.716] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:18:55.293] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:18:55.297] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:18:58.065] [INFO] cheese - 

Started 2016-10-30T06:18:58.064Z GET /signin ::1
[2016-10-30 14:18:58.084] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:27:42.552] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:27:42.555] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:27:49.026] [INFO] cheese - 

Started 2016-10-30T06:27:49.026Z GET /signin ::1
[2016-10-30 14:27:49.040] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:28:52.178] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:28:52.181] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:28:55.265] [INFO] cheese - 

Started 2016-10-30T06:28:55.264Z GET /signin ::1
[2016-10-30 14:28:55.274] [INFO] cheese - Completed 404 undefined
[2016-10-30 14:30:15.470] [INFO] cheese - 

Started 2016-10-30T06:30:15.470Z GET /signin ::1
[2016-10-30 14:30:15.471] [INFO] cheese - Completed 404 undefined
[2016-10-30 14:30:17.221] [INFO] cheese - 

Started 2016-10-30T06:30:17.221Z GET /signin ::1
[2016-10-30 14:30:17.223] [INFO] cheese - Completed 404 undefined
[2016-10-30 14:30:17.899] [INFO] cheese - 

Started 2016-10-30T06:30:17.899Z GET /signin ::1
[2016-10-30 14:30:17.900] [INFO] cheese - Completed 404 undefined
[2016-10-30 14:30:28.412] [INFO] cheese - 

Started 2016-10-30T06:30:28.412Z GET / ::1
[2016-10-30 14:30:28.416] [INFO] cheese - Completed 302 undefined
[2016-10-30 14:30:28.419] [INFO] cheese - 

Started 2016-10-30T06:30:28.419Z GET /signup ::1
[2016-10-30 14:30:28.432] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:30:42.303] [INFO] cheese - 

Started 2016-10-30T06:30:42.303Z GET / ::1
[2016-10-30 14:30:42.304] [INFO] cheese - Completed 302 undefined
[2016-10-30 14:30:42.306] [INFO] cheese - 

Started 2016-10-30T06:30:42.306Z GET /signup ::1
[2016-10-30 14:30:42.312] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:05.880] [INFO] cheese - 

Started 2016-10-30T06:32:05.880Z GET /signup ::1
[2016-10-30 14:32:05.882] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:12.741] [INFO] cheese - 

Started 2016-10-30T06:32:12.741Z GET / ::1
[2016-10-30 14:32:12.741] [INFO] cheese - Completed 302 undefined
[2016-10-30 14:32:12.743] [INFO] cheese - 

Started 2016-10-30T06:32:12.743Z GET /signup ::1
[2016-10-30 14:32:12.749] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:26.652] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:32:26.655] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:32:29.233] [INFO] cheese - 

Started 2016-10-30T06:32:29.233Z GET /signup ::1
[2016-10-30 14:32:29.253] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:31.250] [INFO] cheese - 

Started 2016-10-30T06:32:31.250Z GET /signup ::1
[2016-10-30 14:32:31.258] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:32.045] [INFO] cheese - 

Started 2016-10-30T06:32:32.045Z GET /signup ::1
[2016-10-30 14:32:32.049] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:32.979] [INFO] cheese - 

Started 2016-10-30T06:32:32.979Z GET /signup ::1
[2016-10-30 14:32:32.981] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:36.472] [INFO] cheese - 

Started 2016-10-30T06:32:36.472Z GET / ::1
[2016-10-30 14:32:36.476] [INFO] cheese - Completed 302 undefined
[2016-10-30 14:32:36.824] [INFO] cheese - 

Started 2016-10-30T06:32:36.824Z GET / ::1
[2016-10-30 14:32:36.825] [INFO] cheese - Completed 302 undefined
[2016-10-30 14:32:36.827] [INFO] cheese - 

Started 2016-10-30T06:32:36.827Z GET /signup ::1
[2016-10-30 14:32:36.829] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:32:53.255] [INFO] cheese - 

Started 2016-10-30T06:32:53.255Z GET /signup ::1
[2016-10-30 14:32:53.259] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:41:15.534] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:41:15.537] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:41:18.622] [INFO] cheese - 

Started 2016-10-30T06:41:18.621Z GET /signup ::1
[2016-10-30 14:41:18.643] [INFO] cheese - Completed 500 undefined
[2016-10-30 14:43:17.411] [INFO] cheese - Aristotle listening on port 3000
[2016-10-30 14:43:17.414] [INFO] cheese - You can debug your app with http://localhost:3000
[2016-10-30 14:43:22.685] [INFO] cheese - 

Started 2016-10-30T06:43:22.685Z GET /signup ::1
[2016-10-30 14:43:22.701] [INFO] cheese - Completed 200 undefined
[2016-10-30 15:03:56.687] [INFO] cheese - 

Started 2016-10-30T07:03:56.687Z GET /signup ::1
[2016-10-30 15:03:56.696] [INFO] cheese - Completed 200 undefined
[2016-10-30 15:03:58.915] [INFO] cheese - 

Started 2016-10-30T07:03:58.915Z GET / ::1
[2016-10-30 15:03:58.921] [INFO] cheese - Completed 302 undefined
[2016-10-30 15:03:58.924] [INFO] cheese - 

Started 2016-10-30T07:03:58.924Z GET /signup ::1
[2016-10-30 15:03:58.931] [INFO] cheese - Completed 304 undefined
[2016-10-30 15:04:02.534] [INFO] cheese - 

Started 2016-10-30T07:04:02.534Z GET / ::1
[2016-10-30 15:04:02.538] [INFO] cheese - Completed 302 undefined
[2016-10-30 15:04:02.540] [INFO] cheese - 

Started 2016-10-30T07:04:02.540Z GET /signup ::1
[2016-10-30 15:04:02.542] [INFO] cheese - Completed 304 undefined
[2016-10-30 15:04:04.878] [INFO] cheese - 

Started 2016-10-30T07:04:04.878Z GET / ::1
[2016-10-30 15:04:04.879] [INFO] cheese - Completed 302 undefined
[2016-10-30 15:04:04.882] [INFO] cheese - 

Started 2016-10-30T07:04:04.882Z GET /signup ::1
[2016-10-30 15:04:04.886] [INFO] cheese - Completed 304 undefined
